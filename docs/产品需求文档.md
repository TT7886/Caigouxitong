# 一家百货采购管理系统产品需求文档

## 1. 产品概述

### 1.1 产品名称
一家百货采购管理系统 (Procurement Management System)

### 1.2 产品定位
面向百货零售企业的全流程采购管理系统，支持从采购申请到订单完成的完整业务流程，包含厂家包装和自己包装两种采购模式。

### 1.3 核心价值
- 标准化采购流程，提高采购效率
- 多角色协同工作，确保流程规范
- 自动化流转机制，减少人工干预
- 实时进度跟踪，提升管控能力
- 数据驱动决策，优化采购策略

## 2. 用户角色与权限

### 2.1 角色定义

#### 2.1.1 采购专员 (purchasing_officer)
**职责**: 采购申请创建、采购进度管理、供应商对接
**权限列表**:
- create_purchase_request: 创建采购申请
- view_purchase_requests: 查看采购申请
- edit_own_requests: 编辑自己的申请
- edit_purchase_request: 编辑采购申请
- delete_requests: 删除申请
- resubmit_requests: 重新提交申请
- bulk_upload_skus: 批量上传SKU
- bulk_submit_requests: 批量提交申请
- manage_products: 管理产品
- view_suppliers: 查看供应商
- manage_inventory: 管理库存
- manage_order_allocation: 管理订单分配
- manage_procurement_progress: 管理采购进度
- update_procurement_progress: 更新采购进度
- view_procurement_progress: 查看采购进度
- complete_receiving_confirmation: 收货确认
- edit_procurement_stages: 编辑采购阶段

#### 2.1.2 部门主管 (department_manager)
**职责**: 一级审批、销量查询、供应商管理
**权限列表**:
- view_purchase_requests: 查看采购申请
- approve_purchase_requests: 审批采购申请
- reject_purchase_requests: 拒绝采购申请
- view_reports: 查看报表
- edit_purchase_quantities: 编辑采购数量
- partial_approve_skus: 部分审批SKU
- manage_products: 管理产品
- view_suppliers: 查看供应商
- manage_suppliers: 管理供应商
- view_order_allocation: 查看订单分配

#### 2.1.3 总经理 (general_manager)
**职责**: 最终审批、全局数据查看、战略决策
**权限列表**:
- view_purchase_requests: 查看采购申请
- final_approve_purchase_requests: 最终审批采购申请
- reject_purchase_requests: 拒绝采购申请
- view_reports: 查看报表
- view_all_data: 查看所有数据
- view_card_progress: 查看纸卡进度
- manage_products: 管理产品
- view_suppliers: 查看供应商
- manage_suppliers: 管理供应商
- view_order_allocation: 查看订单分配

#### 2.1.4 纸卡设计人员 (card_designer)
**职责**: 纸卡设计、制作进度管理
**权限列表**:
- view_card_progress: 查看纸卡进度
- update_card_design: 更新纸卡设计
- edit_card_progress: 编辑纸卡进度
- view_assigned_tasks: 查看分配任务
- view_order_allocation: 查看订单分配

#### 2.1.5 辅料人员 (accessory_staff)
**职责**: 辅料采购、制作进度管理、成本录入
**权限列表**:
- view_accessory_progress: 查看辅料进度
- edit_accessory_progress: 编辑辅料进度
- update_accessory_status: 更新辅料状态
- view_assigned_tasks: 查看分配任务
- view_order_allocation: 查看订单分配

#### 2.1.6 生产人员 (production_staff)
**职责**: 生产排单、验收管理、质量检查
**权限列表**:
- view_production_tasks: 查看生产任务
- update_production_progress: 更新生产进度
- view_accessory_progress: 查看辅料进度
- view_order_allocation: 查看订单分配
- manage_in_house_production: 管理自己包装
- edit_in_house_production: 编辑自己包装
- manage_production_scheduling: 管理生产排单
- edit_production_scheduling: 编辑生产排单
- upload_inspection_images: 上传验收图片
- complete_inspection: 完成验收
- view_inspection_history: 查看验收历史
- manage_procurement_management: 采购管理权限
- edit_procurement_stages: 编辑采购阶段

#### 2.1.7 仓管人员 (warehouse_staff)
**职责**: 验货入库、数据录入、库存管理
**权限列表**:
- view_receiving: 查看收货
- view_quality_checks: 查看质量检查
- update_quality_status: 更新质量状态
- reject_items: 拒收物品

#### 2.1.8 物流专员 (logistics_staff)
**职责**: 发货出柜、物流跟踪
**权限列表**:
- view_shipments: 查看发货
- update_shipping_status: 更新发货状态
- create_containers: 创建集装箱
- view_logistics_reports: 查看物流报表
- view_card_progress: 查看纸卡进度
- view_suppliers: 查看供应商
- view_order_allocation: 查看订单分配
- manage_shipping_outbound: 管理发货出柜
- edit_shipping_outbound: 编辑发货出柜

#### 2.1.9 财务人员 (finance_personnel)
**职责**: 付款确认、财务记录、对账管理
**权限列表**:
- view_finance_records: 查看财务记录
- edit_finance_records: 编辑财务记录
- send_payment_reminders: 发送付款提醒
- confirm_payments: 确认付款
- view_financial_reports: 查看财务报表
- export_financial_data: 导出财务数据
- view_order_allocation: 查看订单分配
- view_purchase_requests: 查看采购申请

## 3. 系统功能模块

### 3.1 仪表板 (Dashboard)
**功能描述**: 系统概览和数据管理中心

#### 3.1.1 概览页面
**统计卡片**:
- 采购申请总数 (蓝色图标: FileText)
- 待审批订单 (黄色图标: Clock)
- 进行中订单 (绿色图标: TrendingUp)
- 本月完成 (翠绿图标: CheckCircle)
- 逾期项目 (红色图标: AlertTriangle)
- 质量问题 (橙色图标: Package)
- 活跃供应商 (紫色图标: Users)
- 在途货物 (靛蓝图标: Truck)

**图表组件**:
- 采购进度分析 (ProgressChart)
- 最近活动 (RecentActivity)

#### 3.1.2 产品列表页面
**功能**:
- 产品信息展示 (SKU编码、产品名称、英文品名、产品类别、识别码、图片)
- 新增产品 (CreateProduct)
- 编辑产品 (EditProduct)
- 批量导入 (BulkUpload)
- 导出功能
- 搜索过滤

**字段定义**:
```typescript
interface SKU {
  id: string;
  code: string;           // SKU编码
  name: string;           // 产品名称
  englishName: string;    // 英文品名
  category: string;       // 产品类别
  identificationCode: string; // 识别码
  imageUrl?: string;      // 图片地址
}
```

#### 3.1.3 供应商管理页面
**功能**:
- 供应商信息展示
- 供应商评级 (1-5星)
- 联系信息管理
- 绩效统计

**字段定义**:
```typescript
interface Supplier {
  id: string;
  name: string;           // 供应商名称
  code: string;           // 供应商编码
  contactPerson: string;  // 联系人
  phone: string;          // 电话
  email: string;          // 邮箱
  address: string;        // 地址
  country: string;        // 国家
  city: string;           // 城市
  paymentTerms: string;   // 付款条件
  leadTime: number;       // 交货周期(天)
  rating: number;         // 评级(1-5)
  isActive: boolean;      // 是否活跃
  remarks?: string;       // 备注
}
```

#### 3.1.4 库存销量页面
**功能**:
- 库存状态监控
- 销量预测分析
- 补货建议
- 批量导入导出

**字段定义**:
```typescript
interface InventoryItem {
  id: string;
  skuId: string;
  sku: SKU;
  inTransitQuantity: number;      // 在途数
  inStockQuantity: number;        // 在库数
  totalQuantity: number;          // 总库存
  replenishmentCycle: number;     // 补货周期(天)
  replenishmentPoint: number;     // 补货点
  targetCoveragePeriod: number;   // 目标覆盖期(天)
  forecastMonthlySales: number;   // 预测月销量
  estimatedSalesDays: number;     // 预计可售时间(天)
  suggestedReplenishment: number; // 建议补货量
}
```

### 3.2 采购申请 (Purchase Requests)
**功能描述**: 管理所有采购请求和订单

#### 3.2.1 主要功能
- 创建采购申请 (CreatePurchaseRequest)
- 编辑采购申请 (EditPurchaseRequest)
- 批量导入申请 (BulkImportPurchaseRequests)
- 申请列表查看 (PurchaseRequestList)
- 筛选和搜索 (FilterPanel)

#### 3.2.2 核心字段
```typescript
interface PurchaseRequest {
  id: string;
  requestNumber: string;          // 申请编号
  requesterId: string;            // 申请人ID
  requester: User;                // 申请人信息
  items: PurchaseRequestItem[];   // 采购项目
  totalAmount: number;            // 总金额
  status: OrderStatus;            // 订单状态
  approvalStatus: ApprovalStatus; // 审批状态
  deadline: Date;                 // 截止日期
  remarks?: string;               // 备注
  // 审批相关字段
  firstApproverId?: string;       // 一级审批人ID
  firstApprover?: User;           // 一级审批人
  firstApprovalDate?: Date;       // 一级审批时间
  firstApprovalRemarks?: string;  // 一级审批备注
  finalApproverId?: string;       // 最终审批人ID
  finalApprover?: User;           // 最终审批人
  finalApprovalDate?: Date;       // 最终审批时间
  finalApprovalRemarks?: string;  // 最终审批备注
}

interface PurchaseRequestItem {
  id: string;
  skuId: string;                  // SKU ID
  sku: SKU;                       // SKU信息
  quantity: number;               // 数量
  unitPrice?: number;             // 单价
  totalPrice?: number;            // 总价
  remarks?: string;               // 备注
  status: ItemStatus;             // 项目状态
  material?: string;              // 材料
  packagingMethod?: string;       // 包装方式
  // 分配阶段添加的字段
  supplierId?: string;            // 供应商ID
  supplier?: Supplier;            // 供应商信息
  deadline?: Date;                // 截止日期
  paymentTerms?: string;          // 付款条件
}
```

#### 3.2.3 状态枚举
```typescript
type OrderStatus = 
  | 'draft'             // 草稿
  | 'submitted'         // 已提交
  | 'first_approved'    // 一级审批通过
  | 'approved'          // 已批准
  | 'allocated'         // 已分配
  | 'rejected'          // 已拒绝
  | 'in_production'     // 生产中
  | 'quality_check'     // 质检中
  | 'ready_to_ship'     // 待发货
  | 'shipped'           // 已发货
  | 'completed';        // 已完成

type ApprovalStatus = 
  | 'pending'           // 待审批
  | 'first_approved'    // 一级审批通过
  | 'approved'          // 最终审批通过
  | 'rejected';         // 已拒绝
```

#### 3.2.4 批量导入功能
**模板格式**: CSV文件
**必填字段**: SKU、单价、数量
**可选字段**: 材料、包装方式
**订单编号规则**: 
- 厂家包装: CF-YYYYMMDDXXXXXX
- 自己包装: WJ-YYYYMMDDXXXXXX

### 3.3 工单审批 (Approvals)
**功能描述**: 部门主管和总经理审批采购申请

#### 3.3.1 审批流程
1. **一级审批** (部门主管)
   - 审批已提交的申请
   - 可编辑采购数量
   - 支持部分审批SKU
   - 可查询销量数据辅助决策

2. **最终审批** (总经理)
   - 审批一级通过的申请
   - 最终决策权
   - 可查看完整业务数据

#### 3.3.2 销量查询功能
**触发条件**: 部门主管或总经理点击"销量查询"按钮
**显示数据**:
- 在途数量 (蓝色)
- 在库数量 (绿色)
- 总库存 (紫色)
- 预测月销量 (橙色)
- 预计可售时间 (红色)
- 建议补货量 (靛蓝色)

#### 3.3.3 审批操作
- **通过**: 更新审批状态，记录审批人和时间
- **驳回**: 设置为rejected状态，记录驳回原因
- **部分审批**: 针对单个SKU设置approved/rejected状态

### 3.4 订单分配 (Order Allocation)
**功能描述**: 将审批通过的订单进行分配配置

#### 3.4.1 分配配置
```typescript
interface OrderAllocation {
  id: string;
  purchaseRequestId: string;      // 采购申请ID
  type: PurchaseType;             // 包装类型
  paymentMethod: PaymentMethod;   // 付款方式
  prepaymentAmount?: number;      // 预付定金金额
  creditDate?: Date;              // 账期日期
  productionDate: Date;           // 生产日期
  deliveryDate: Date;             // 交货日期
  allocationStatus: AllocationStatus; // 分配状态
  allocatedBy: string;            // 分配人ID
  allocatedAt: Date;              // 分配时间
  cardType?: CardType;            // 纸卡类型
  remarks?: string;               // 分配备注
}

type PurchaseType = 'external' | 'in_house'; // 厂家包装 | 自己包装

type PaymentMethod = 
  | 'payment_on_delivery'  // 付款发货
  | 'cash_on_delivery'     // 货到付款
  | 'credit_terms';        // 账期

type CardType =
  | 'finished'           // 纸卡成品
  | 'design'             // 设计稿
  | 'none';              // 不需要
```

#### 3.4.2 自动创建机制
分配完成后自动创建:
- 采购进度记录 (ProcurementProgress)
- 纸卡进度记录 (CardProgress)
- 辅料进度记录 (AccessoryProgress)

### 3.5 采购进度 (Purchase Progress)
**功能描述**: 管理采购订单的全流程进度跟踪

#### 3.5.1 流程节点
标准8个节点流程:
1. **定金支付** (系统联动)
2. **安排生产** (采购专员操作)
3. **纸卡提供** (系统联动)
4. **包装生产** (采购专员操作)
5. **尾款支付** (系统联动)
6. **安排发货** (采购专员操作)
7. **到货确认** (采购专员操作)
8. **验收确认** (系统联动)

#### 3.5.2 节点状态
```typescript
type StageStatus = 
  | 'not_started'           // 未开始
  | 'in_progress'           // 进行中
  | 'completed'             // 已完成
  | 'no_deposit_required';  // 无需定金
```

#### 3.5.3 批量操作功能
- 批量完成手动节点
- 批量催付定金/尾款
- 批量催要纸卡
- 支持多订单同时操作

#### 3.5.4 催付功能
- **定金催付**: 通知财务人员处理定金支付
- **尾款催付**: 通知财务人员处理尾款支付
- **纸卡催要**: 通知纸卡设计人员加快进度

### 3.6 纸卡进度 (Card Progress)
**功能描述**: 按订单管理纸卡设计和制作进度

#### 3.6.1 进度阶段
标准纸卡制作流程:
1. **设计确认**
2. **样品制作**
3. **客户确认**
4. **批量生产**
5. **质量检查**
6. **包装发货**

#### 3.6.2 核心字段
```typescript
interface CardProgress {
  id: string;
  purchaseRequestId: string;      // 采购申请ID
  skuId: string;                  // SKU ID
  sku: SKU;                       // SKU信息
  isFinalized: boolean;           // 是否已定稿
  stages: CardProgressStage[];    // 阶段列表
  currentStage: number;           // 当前阶段索引
  overallProgress: number;        // 整体进度百分比
  productionQuantity?: number;    // 生产数量
  productionAmount?: number;      // 生产金额
  purchaseQuantity?: number;      // 采购数量
  estimatedCompletionDate?: Date; // 预计完成时间
  actualCompletionDate?: Date;    // 实际完成时间
  isOverdue: boolean;             // 是否延误
  packagingType: 'external' | 'in_house'; // 包装类型
  cardType?: string;              // 纸卡类型
  isManuallyConfirmed?: boolean;  // 是否已手动确认收货
  confirmedDate?: Date;           // 确认收货时间
}

interface CardProgressStage {
  id: string;
  name: string;                   // 阶段名称
  status: TaskStatus;             // 阶段状态
  assignee?: User;                // 负责人
  startDate?: Date;               // 开始日期
  completedDate?: Date;           // 完成日期
  estimatedDuration: number;      // 预计耗时(天)
  actualDuration?: number;        // 实际耗时(天)
  remarks?: string;               // 备注
  order: number;                  // 阶段顺序
}
```

#### 3.6.3 自动监控机制
- 每5秒检查纸卡进度状态
- 所有阶段完成后自动联动采购进度中的"纸卡提供"节点
- 支持批量完成操作

#### 3.6.4 操作功能
- **单个完成**: 纸卡设计人员完成单个阶段
- **批量完成**: 批量完成所有SKU的指定阶段
- **导出功能**: 支持选中订单导出进度报表

### 3.7 辅料进度 (Accessory Progress)
**功能描述**: 按订单管理辅料制作和进度

#### 3.7.1 辅料类型
```typescript
type AccessoryType = 
  | 'blister'      // 泡壳 (长周期)
  | 'tray'         // 中托 (长周期)
  | 'carton'       // 纸箱 (短周期)
  | 'barcode'      // 条码 (短周期)
  | 'label';       // 唛头 (短周期)

type AccessoryCycle = 
  | 'long'         // 长周期
  | 'short';       // 短周期
```

#### 3.7.2 核心字段
```typescript
interface AccessoryProgress {
  id: string;
  purchaseRequestId: string;      // 采购申请ID
  skuId: string;                  // SKU ID
  sku: SKU;                       // SKU信息
  accessories: AccessoryItem[];   // 辅料项目列表
  overallProgress: number;        // 整体进度百分比
  purchaseQuantity?: number;      // 采购数量
  totalCost?: number;             // 辅料总成本
  moldCost?: number;              // 模具成本
  dieCost?: number;               // 刀版成本
  // 各项辅料成本
  blisterCost?: number;           // 泡壳成本
  trayCost?: number;              // 中托成本
  cartonCost?: number;            // 纸箱成本
  barcodeCost?: number;           // 条码成本
  labelCost?: number;             // 唛头成本
}

interface AccessoryItem {
  id: string;
  name: string;                   // 辅料名称
  type: AccessoryType;            // 辅料类型
  cycle: AccessoryCycle;          // 周期类型
  status: TaskStatus;             // 状态
  startDate?: Date;               // 开始日期
  completedDate?: Date;           // 完成日期
  estimatedDuration: number;      // 预计耗时(天)
  actualDuration?: number;        // 实际耗时(天)
  remarks?: string;               // 备注
  cost?: number;                  // 辅料成本
}
```

#### 3.7.3 标签页设计
- **未完成订单**: 所有SKU流程未全部完成或成本未填写完整
- **已完成订单**: 所有SKU流程已完成且成本已填写

#### 3.7.4 批量操作
- **批量完成长周期**: 泡壳、中托
- **批量完成短周期**: 纸箱、条码、唛头
- **批量导入成本**: 支持CSV格式批量导入成本数据

#### 3.7.5 成本管理
**批量导入模板字段**:
- 订单编号* (必填)
- SKU编码* (必填)
- 产品名称 (可选)
- 采购数量* (必填)
- 泡壳* (必填)
- 中托* (必填)
- 纸箱* (必填)
- 条码* (必填)
- 唛头* (必填)
- 刀版* (必填)
- 模具* (必填)

### 3.8 自己包装 (In-House Production)
**功能描述**: 以SKU为单位管理自己包装订单的生产和验收流程

#### 3.8.1 SKU流转规则
- **待完成SKU**: 采购进度 < 100% 或 辅料进度 ≤ 80%
- **待验收SKU**: 采购进度 = 100% 且 辅料进度 > 80% (自动流转)
- **已验收SKU**: 完成产品验收和质量检查

#### 3.8.2 验收流程
**待验收操作**:
- 上传验收照片 (支持JPG/PNG格式)
- 填写到货数量
- 验收决策 (通过/不合格)

**验收字段**:
- 订单编号
- SKU信息 (图片、编码、品名、材料、包装方式)
- 采购数量
- 到货数量 (可编辑)
- 验收照片 (可上传多张)
- 验收意见 (通过/不合格)

#### 3.8.3 自动流转机制
验收完成后自动创建生产排单:
```typescript
// 验收通过后自动流转到生产排单
const schedules = createSchedulesFromInHouseProduction(requestId);
```

### 3.9 生产排单 (Production Scheduling)
**功能描述**: 管理生产计划和排单

#### 3.9.1 核心字段
```typescript
interface ProductionSchedule {
  id: string;
  skuId: string;                  // SKU ID
  sku: SKU;                       // SKU信息
  purchaseRequestId: string;      // 采购申请ID
  purchaseRequestNumber?: string; // 订单编号
  scheduledDate: Date;            // 排单日期
  plannedQuantity: number;        // 计划数量
  packagingMethod: string;        // 包装方式
  machine: string;                // 机器
  status: ProductionStatus;       // 生产状态
  completedQuantity?: number;     // 完成数量
  startDate?: Date;               // 开始日期
  endDate?: Date;                 // 结束日期
  operator?: User;                // 操作员
  operatorId?: string;            // 操作员ID
  remarks?: string;               // 备注
}

type ProductionStatus = 
  | 'pending'           // 待排单
  | 'scheduled'         // 已排单
  | 'in_production'     // 生产中
  | 'completed'         // 已完成
  | 'cancelled';        // 已取消
```

#### 3.9.2 可用机器
- 包装机A、包装机B、包装机C、包装机D
- 组装线1、组装线2
- 测试台1、测试台2

#### 3.9.3 批量操作
- 批量创建排单 (BulkScheduleForm)
- 批量更新状态
- 批量分配操作员

### 3.10 验货入库 (Quality Control)
**功能描述**: 管理货物验收和入库检验，以SKU为单位进行详细数据记录

#### 3.10.1 标签页设计
- **待验收**: 仓管人员填写验收数据
- **已验收**: 显示完整验收记录

#### 3.10.2 验收数据字段
**仓管人员填写字段**:
- 中包数 (packageCount)
- 总件数 (totalPieces)
- 单件数量 (piecesPerUnit)
- 外箱长(cm) (boxLength)
- 外箱宽(cm) (boxWidth)
- 外箱高(cm) (boxHeight)
- 单件重量(kg) (unitWeight)

**系统自动计算字段**:
- 总数量 = 总件数 × 单件数量
- 外箱体积(m³) = 长×宽×高÷1,000,000
- 总体积(m³) = 总件数 × 外箱体积
- 总重量(kg) = 总件数 × 单件重量

#### 3.10.3 权限控制
- 只有仓管人员可以编辑和保存验收信息
- 其他角色只能查看验收数据

### 3.11 发货出柜 (Shipping Outbound)
**功能描述**: 管理货物发货流程，支持批量操作和精细化发货控制

#### 3.11.1 标签页设计
- **待发货**: 显示已验收完成的SKU，支持选择和预发货
- **预发货**: 可编辑发货件数，支持部分发货
- **已发货**: 显示发货批次记录

#### 3.11.2 发货流程
1. **待发货 → 预发货**: 选择SKU进入预发货状态
2. **预发货 → 已发货**: 确认发货，生成发货批次
3. **部分发货处理**: 自动创建剩余数量的新记录

#### 3.11.3 发货批次管理
```typescript
interface ShippedBatch {
  id: string;
  batchNumber: string;            // 批次编号 (SHIP-YYYYMMDD-XXX)
  skuCount: number;               // SKU数量
  totalWeight: number;            // 总重量
  totalVolume: number;            // 总体积
  shipmentDate: Date;             // 发货时间
  items: ShippedItem[];           // 发货项目
}
```

#### 3.11.4 权限控制
- 只有物流专员可以执行发货操作
- 其他角色只能查看发货数据

### 3.12 财务管理 (Finance Management)
**功能描述**: 管理订单付款和财务记录

#### 3.12.1 标签页设计
- **定金支付**: 需要定金支付的订单
- **付款发货**: 付款发货和货到付款订单
- **账期付款**: 账期付款订单
- **财务报表**: 财务统计分析

#### 3.12.2 付款确认功能
- **确认定金**: 联动更新采购进度中的"定金支付"节点
- **确认尾款**: 联动更新采购进度中的"尾款支付"节点
- **确认账期付款**: 独立记录，不联动采购进度

#### 3.12.3 催付记录显示
- 显示催付时间和付款时间
- 区分不同付款类型的状态
- 支持付款状态查询

## 4. 界面设计规范

### 4.1 色彩系统
**主色调**: 蓝色系 (#3B82F6, #1D4ED8, #1E40AF)
**状态色彩**:
- 成功/完成: 绿色 (#10B981, #059669)
- 警告/进行中: 黄色 (#F59E0B, #D97706)
- 错误/拒绝: 红色 (#EF4444, #DC2626)
- 信息/待处理: 蓝色 (#3B82F6, #2563EB)
- 中性: 灰色 (#6B7280, #4B5563)

### 4.2 组件规范

#### 4.2.1 StatusBadge组件
```typescript
interface StatusBadgeProps {
  status: string;     // 状态文本
  color: string;      // 颜色主题
  size?: 'sm' | 'md' | 'lg'; // 尺寸
}
```

#### 4.2.2 ProgressBar组件
```typescript
interface ProgressBarProps {
  progress: number;   // 进度百分比
  color?: 'blue' | 'green' | 'yellow' | 'red' | 'purple' | 'gray';
  size?: 'sm' | 'md' | 'lg';
  showPercentage?: boolean;
}
```

### 4.3 布局规范
- **侧边栏宽度**: 256px (w-64)
- **主内容区**: flex-1
- **卡片间距**: 24px (space-y-6)
- **表格行高**: 64px (py-4)
- **按钮高度**: 40px (py-2)

### 4.4 响应式设计
- **移动端**: 隐藏侧边栏，顶部导航
- **平板端**: 保持侧边栏，调整表格布局
- **桌面端**: 完整布局显示

## 5. 数据流转逻辑

### 5.1 主流程流转
```
采购申请 → 一级审批 → 最终审批 → 订单分配 → 执行阶段 → 完成
```

### 5.2 厂家包装流程
```
订单分配 → 采购进度管理 → 纸卡进度管理 → 辅料进度管理 → 财务付款 → 验货入库 → 发货出柜
```

### 5.3 自己包装流程
```
订单分配 → 采购进度管理 → 纸卡进度管理 → 辅料进度管理 → 产品验收 → 生产排单 → 验货入库 → 发货出柜
```

### 5.4 自动化联动机制

#### 5.4.1 纸卡进度联动
```typescript
// 纸卡制作完成 → 自动更新采购进度"纸卡提供"节点
checkAndUpdateCardProgressCompletion();
```

#### 5.4.2 财务付款联动
```typescript
// 付款确认 → 自动更新采购进度对应节点
confirmPayment(requestId, paymentType);
```

#### 5.4.3 验收完成联动
```typescript
// 自己包装验收完成 → 自动创建生产排单
createSchedulesFromInHouseProduction(requestId);
```

## 6. 导入导出功能

### 6.1 批量导入功能

#### 6.1.1 产品批量导入
**文件格式**: CSV
**模板字段**: SKU编码*, 产品名称*, 英文品名*, 产品类别*, 识别码*, 图片地址
**验证规则**: 必填字段检查、重复性检查

#### 6.1.2 采购申请批量导入
**文件格式**: CSV
**模板字段**: SKU*, 材料, 包装方式, 单价*, 数量*
**生成规则**: 一张表格生成一个采购申请

#### 6.1.3 库存销量批量导入
**文件格式**: CSV
**模板字段**: SKU*, 品名, 在途数*, 在库数*, 总库存*, 补货周期*, 补货点*, 目标覆盖期*, 预测月销量*, 预计可售时间*, 建议补货量*
**验证规则**: 总库存 = 在途数 + 在库数

#### 6.1.4 辅料成本批量导入
**文件格式**: CSV
**模板字段**: 订单编号*, SKU编码*, 产品名称, 采购数量*, 泡壳*, 中托*, 纸箱*, 条码*, 唛头*, 刀版*, 模具*
**计算规则**: 辅料总成本 = 各项成本之和

#### 6.1.5 生产排单批量导入
**文件格式**: CSV
**模板字段**: SKU编码*, 排单日期*, 计划数量*, 包装方式*, 机器*, 备注
**日期格式**: YYYY-MM-DD

### 6.2 导出功能

#### 6.2.1 通用导出规则
- **文件格式**: CSV (UTF-8编码)
- **文件命名**: 模块名_状态_日期.csv
- **选择导出**: 支持选中记录导出
- **全量导出**: 支持当前筛选结果全量导出

#### 6.2.2 各模块导出字段

**产品列表导出**:
SKU编码, 产品名称, 英文品名, 产品类别, 识别码, 图片地址

**库存销量导出**:
SKU, 品名, 在途数, 在库数, 总库存, 补货周期, 补货点, 目标覆盖期, 预测月销量, 预计可售时间, 建议补货量, 状态

**纸卡进度导出**:
订单编号, SKU, 产品名称, 阶段名称, 状态, 开始日期, 完成日期, 预计耗时, 实际耗时, 整体进度

**辅料进度导出**:
订单编号, SKU编码, 产品名称, 辅料类型, 周期类型, 状态, 完成日期, 整体进度

**发货批次导出**:
批次编号, SKU数量, 发货总重量(kg), 发货总体积(m³), 发货时间 + SKU详情

## 7. 搜索和筛选功能

### 7.1 搜索功能
**全局搜索字段**:
- 订单编号
- SKU编码
- 产品名称
- 供应商名称
- 申请人姓名

### 7.2 筛选功能
**筛选维度**:
- 状态筛选 (多选)
- 类型筛选 (厂家包装/自己包装)
- 日期范围筛选
- 申请人筛选
- 供应商筛选

### 7.3 分页功能
- **页面大小**: 15条/页
- **分页控件**: 首页、上一页、页码、下一页、末页
- **页码显示**: 智能省略号显示
- **记录统计**: 显示当前页范围和总记录数

## 8. 通知和提醒机制

### 8.1 催付功能
- **定金催付**: 采购专员发起，财务人员接收
- **尾款催付**: 采购专员发起，财务人员接收
- **催付记录**: 显示催付时间和付款时间

### 8.2 催要功能
- **纸卡催要**: 采购专员发起，纸卡设计人员接收
- **催要记录**: 显示催要时间和完成时间

### 8.3 系统通知
- **操作成功**: 绿色通知，3秒自动消失
- **操作失败**: 红色通知，需手动关闭
- **权限提示**: 黄色提示框，说明权限限制

## 9. 数据验证规则

### 9.1 必填字段验证
- 所有标记*的字段必须填写
- 数量字段必须大于0
- 价格字段必须为非负数

### 9.2 业务逻辑验证
- SKU必须在产品列表中存在
- 总库存 = 在途数 + 在库数
- 发货件数不能超过总件数
- 审批权限检查

### 9.3 文件上传验证
- 图片格式: JPG/PNG
- 文件大小: 最大10MB
- CSV编码: UTF-8
- 数据格式: 严格按照模板格式

## 10. 性能和用户体验

### 10.1 加载优化
- 分页加载，避免大数据量渲染
- 图片懒加载和错误处理
- 搜索防抖，减少请求频率

### 10.2 交互体验
- 悬停效果和过渡动画
- 图片点击放大功能
- 批量操作进度提示
- 操作确认对话框

### 10.3 数据实时性
- 自动监控机制 (纸卡进度每5秒检查)
- 状态联动更新
- 实时计算和统计

## 11. 安全和权限

### 11.1 权限控制
- 基于角色的权限系统
- 页面级权限控制
- 操作级权限验证
- 数据级权限过滤

### 11.2 数据安全
- 用户身份验证
- 操作日志记录
- 数据备份机制
- 敏感信息保护

## 12. 扩展性设计

### 12.1 模块化架构
- 独立的Store管理
- 组件化UI设计
- 标准化接口定义
- 可插拔功能模块

### 12.2 配置化支持
- 角色权限配置
- 流程节点配置
- 状态枚举配置
- 业务规则配置

## 13. 技术实现要点

### 13.1 状态管理
```typescript
// Store模式实现
class ProcurementStore {
  private listeners: Array<() => void> = [];
  
  subscribe(listener: () => void) {
    this.listeners.push(listener);
    return () => {
      this.listeners = this.listeners.filter(l => l !== listener);
    };
  }
  
  notify() {
    this.listeners.forEach(listener => listener());
  }
}
```

### 13.2 自动化机制
```typescript
// 定时监控实现
useEffect(() => {
  checkAndUpdateCardProgressCompletion();
  const interval = setInterval(() => {
    checkAndUpdateCardProgressCompletion();
  }, 5000);
  return () => clearInterval(interval);
}, []);
```

### 13.3 权限验证
```typescript
// 权限检查实现
hasPermission(permission: string): boolean {
  if (!this.currentUser) return false;
  const permissions = this.getRolePermissions(this.currentUser.role);
  return permissions.includes(permission);
}
```

## 14. 部署和维护

### 14.1 环境要求
- Node.js 18+
- 现代浏览器支持
- 响应式设计适配

### 14.2 数据备份
- 定期数据导出
- 关键操作日志
- 系统状态监控

### 14.3 用户培训
- 角色操作手册
- 流程培训材料
- 常见问题解答

---

**文档版本**: v1.0
**创建日期**: 2025年1月18日
**最后更新**: 2025年1月18日
**维护人员**: 系统开发团队